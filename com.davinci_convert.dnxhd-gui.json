{
  "app-id": "com.davinci_convert.dnxhd-gui",
  "runtime": "org.gnome.Platform",
  "runtime-version": "48",
  "sdk": "org.gnome.Sdk",
  "command": "dnxhd_gui",
  "finish-args": [
    "--share=network",
    "--filesystem=host",
    "--env=RUST_LOG=info",
    "--socket=fallback-x11",
    "--socket=wayland"
  ],
  "sdk-extensions": ["org.freedesktop.Sdk.Extension.rust-stable"],
  "modules": [
    {
      "name": "nasm",
      "sources": [
        {
          "type": "archive",
          "url": "https://www.nasm.us/pub/nasm/releasebuilds/2.16.01/nasm-2.16.01.tar.xz",
          "sha256": "c77745f4802375efeee2ec5c0ad6b7f037ea9c87c92b149a9637ff099f162558"
        }
      ],
      "buildsystem": "simple",
      "build-commands": [
        "./configure --prefix=/app",
        "make -j$(nproc)",
        "make install"
      ]
    },
    {
      "name": "ffmpeg",
      "sources": [
        {
          "type": "archive",
          "url": "https://ffmpeg.org/releases/ffmpeg-6.1.2.tar.xz",
          "sha256": "3b624649725ecdc565c903ca6643d41f33bd49239922e45c9b1442c63dca4e38"
        }
      ],
      "buildsystem": "simple",
      "build-commands": [
        "./configure --prefix=/app --disable-debug --disable-doc --disable-ffplay --disable-network --disable-everything --enable-ffmpeg --enable-ffprobe --enable-protocol=file --enable-protocol=pipe --enable-demuxer=mov --enable-demuxer=mp4 --enable-muxer=mov --enable-muxer=mxf --enable-decoder=h264 --enable-decoder=aac --enable-decoder=pcm_s16le --enable-decoder=pcm_s24le --enable-encoder=dnxhd --enable-encoder=pcm_s16le --enable-encoder=pcm_s24le --enable-parser=h264 --enable-bsf=h264_mp4toannexb --enable-filter=scale --enable-filter=format --enable-filter=aformat --enable-filter=loudnorm",
        "make -j$(nproc)",
        "make install"
      ]
    },
    {
      "name": "dnxhd_gui",
      "buildsystem": "simple",
      "build-commands": [
        "cargo fetch || true",
        "cargo build --release",
        "install -Dm755 target/release/dnxhd_gui /app/bin/dnxhd_gui"
      ],
      "sources": [
        {
          "type": "dir",
          "path": ".."
        }
      ],
      "post-install": [
        "install -Dm644 packaging/com.davinci_convert.dnxhd-gui.desktop /app/share/applications/com.davinci_convert.dnxhd-gui.desktop",
        "install -Dm644 packaging/com.davinci_convert.dnxhd-gui.svg /app/share/icons/hicolor/scalable/apps/com.davinci_convert.dnxhd-gui.svg"
      ],
      "build-options": {
        "append-path": "/usr/lib/sdk/rust-stable/bin",
        "env": {
          "CARGO_HOME": "/run/build/dnxhd_gui/cargo"
        },
        "build-args": [
          "--share=network"
        ]
      }
    }
  ]
}
